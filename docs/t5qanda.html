<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>e4c2de875b544ad9922283137b2101cd</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<section id="problem-statement" class="cell markdown">
<h1>Problem Statement</h1>
<h2
id="fine-tuning-t5-for-question-answering-using-huggingface-transformers">Fine-Tuning
T5 for Question Answering using HuggingFace Transformers</h2>
<p>To build a model that can generate answers based on given context and
questions , we focused on finetuning a hugging face model T5 for
creating a q&amp;a context chatbot</p>
</section>
<div class="cell markdown">
<p>Topic and code reference : <a
href="https://analyticsindiamag.com/guide-to-question-answering-system-with-t5-transformer/"
class="uri">https://analyticsindiamag.com/guide-to-question-answering-system-with-t5-transformer/</a></p>
</div>
<section id="about-t5-transformer-hugging-face" class="cell markdown">
<h1>About T5 transformer Hugging Face</h1>
<p>About the T5 transformer- The T5 model is based on the Transformer
architecture, which is a type of neural network that is designed to
process sequential input data efficiently. It consists of an encoder and
a decoder, which are both made up of a series of interconnected
"layers."</p>
<p>Each layer in the encoder and decoder is made up of a series of
"attention" mechanisms and "feedforward" networks. The attention
mechanisms allow the model to focus on different parts of the input
sequence at different times, while the feedforward networks transform
the input data using a series of weights and biases.</p>
<p>The T5 model also uses something called "self-attention," which
allows each element in the input sequence to attend to all of the other
elements in the sequence. This enables the model to capture
relationships between words and phrases in the input data, which is
important for many NLP tasks.</p>
<p>In addition to the encoder and decoder, the T5 model also includes
something called a "language model head," which is used to predict the
next word in a sequence given the previous words. This is important for
tasks like translation and text generation, where the model needs to
generate coherent and natural-sounding output.</p>
<p>Overall, the T5 model is a very large and complex neural network, but
it is designed to be highly efficient and effective at processing
sequential data. It has been trained on a massive dataset of text and
can perform a wide range of NLP tasks with state-of-the-art
accuracy.</p>
</section>
<section id="import-necessary-libraries" class="cell markdown">
<h1>Import necessary libraries</h1>
</section>
<div class="cell code" data-execution_count="1"
data-_cell_guid="b1076dfc-b9ad-4769-8c92-a6c4dae69d19"
data-_uuid="8f2839f25d086af736a60e9eeb907d3b93b6e0e5"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-13T07:11:04.997844Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-13T07:11:04.997370Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-13T07:11:14.578297Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-13T07:11:14.577279Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-01-13T07:11:04.997763Z&quot;}">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> T5Tokenizer</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> T5ForConditionalGeneration, AdamW</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytorch_lightning <span class="im">as</span> pl</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pytorch_lightning.callbacks <span class="im">import</span> ModelCheckpoint</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>pl.seed_everything(<span class="dv">100</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&quot;ignore&quot;</span>)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>Global seed set to 100
</code></pre>
</div>
</div>
<section id="import-dataset" class="cell markdown">
<h1>Import Dataset</h1>
</section>
<div class="cell code" data-execution_count="2"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-13T07:11:14.580953Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-13T07:11:14.580247Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-13T07:11:14.804856Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-13T07:11:14.803699Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-01-13T07:11:14.580922Z&quot;}">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;D:/GeorgeBrownSubjects/DeepLearningMaths/Project2/Data/SQuAD_csv.csv&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df.columns</span></code></pre></div>
<div class="output execute_result" data-execution_count="2">
<pre><code>Index([&#39;Unnamed: 0&#39;, &#39;context&#39;, &#39;question&#39;, &#39;id&#39;, &#39;answer_start&#39;, &#39;text&#39;], dtype=&#39;object&#39;)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="3"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-13T07:11:14.807805Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-13T07:11:14.806689Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-13T07:11:14.823561Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-13T07:11:14.822377Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-01-13T07:11:14.807760Z&quot;}">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[[<span class="st">&#39;context&#39;</span>,<span class="st">&#39;question&#39;</span>, <span class="st">&#39;text&#39;</span>]]</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="4"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-13T07:11:14.829190Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-13T07:11:14.828899Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-13T07:11:14.835697Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-13T07:11:14.834325Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-01-13T07:11:14.829163Z&quot;}">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Number of records: &quot;</span>, df.shape[<span class="dv">0</span>])</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Number of records:  86821
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="5"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-13T07:11:14.839181Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-13T07:11:14.838285Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-13T07:11:14.907631Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-13T07:11:14.906705Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-01-13T07:11:14.839140Z&quot;}">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;context&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;context&quot;</span>].<span class="bu">str</span>.lower()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;question&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;question&quot;</span>].<span class="bu">str</span>.lower()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;text&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;text&quot;</span>].<span class="bu">str</span>.lower()</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="5">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>context</th>
      <th>question</th>
      <th>text</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>beyoncé giselle knowles-carter (/biːˈjɒnseɪ/ b...</td>
      <td>when did beyonce start becoming popular?</td>
      <td>in the late 1990s</td>
    </tr>
    <tr>
      <th>1</th>
      <td>beyoncé giselle knowles-carter (/biːˈjɒnseɪ/ b...</td>
      <td>what areas did beyonce compete in when she was...</td>
      <td>singing and dancing</td>
    </tr>
    <tr>
      <th>2</th>
      <td>beyoncé giselle knowles-carter (/biːˈjɒnseɪ/ b...</td>
      <td>when did beyonce leave destiny's child and bec...</td>
      <td>2003</td>
    </tr>
    <tr>
      <th>3</th>
      <td>beyoncé giselle knowles-carter (/biːˈjɒnseɪ/ b...</td>
      <td>in what city and state did beyonce  grow up?</td>
      <td>houston, texas</td>
    </tr>
    <tr>
      <th>4</th>
      <td>beyoncé giselle knowles-carter (/biːˈjɒnseɪ/ b...</td>
      <td>in which decade did beyonce become famous?</td>
      <td>late 1990s</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="6"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-13T07:11:14.909596Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-13T07:11:14.909254Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-13T07:11:15.018148Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-13T07:11:15.016536Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-01-13T07:11:14.909560Z&quot;}">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>DEVICE <span class="op">=</span> torch.device(<span class="st">&#39;cuda&#39;</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">&#39;cpu&#39;</span>) </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>INPUT_MAX_LEN <span class="op">=</span> <span class="dv">512</span> <span class="co"># Input length</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>OUT_MAX_LEN <span class="op">=</span> <span class="dv">128</span> <span class="co"># Output Length</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>TRAIN_BATCH_SIZE <span class="op">=</span> <span class="dv">8</span> <span class="co"># Training Batch Size</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>VALID_BATCH_SIZE <span class="op">=</span> <span class="dv">2</span> <span class="co"># Validation Batch Size</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>EPOCHS <span class="op">=</span> <span class="dv">5</span> <span class="co"># Number of Iteration</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="7"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-13T07:11:15.020855Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-13T07:11:15.020027Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-13T07:11:15.924492Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-13T07:11:15.923613Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-01-13T07:11:15.020808Z&quot;}">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>MODEL_NAME <span class="op">=</span> <span class="st">&quot;t5-base&quot;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>tokenizer <span class="op">=</span> T5Tokenizer.from_pretrained(MODEL_NAME, model_max_length<span class="op">=</span> INPUT_MAX_LEN)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="8"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-13T07:11:15.926334Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-13T07:11:15.925784Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-13T07:11:15.933885Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-13T07:11:15.931825Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-01-13T07:11:15.926296Z&quot;}">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;eos_token: </span><span class="sc">{}</span><span class="st"> and id: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(tokenizer.eos_token, tokenizer.eos_token_id)) <span class="co"># End of token (eos_token)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;unk_token: </span><span class="sc">{}</span><span class="st"> and id: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(tokenizer.unk_token, tokenizer.eos_token_id)) <span class="co"># Unknown token (unk_token)</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;pad_token: </span><span class="sc">{}</span><span class="st"> and id: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(tokenizer.pad_token, tokenizer.eos_token_id)) <span class="co"># Pad token (pad_token)</span></span></code></pre></div>
<div class="output stream stdout">
<pre><code>eos_token: &lt;/s&gt; and id: 1
unk_token: &lt;unk&gt; and id: 1
pad_token: &lt;pad&gt; and id: 1
</code></pre>
</div>
</div>
<section id="dataset-preparation" class="cell markdown">
<h1>Dataset Preparation</h1>
<hr>
</section>
<div class="cell code" data-execution_count="9"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-13T07:11:15.936375Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-13T07:11:15.935392Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-13T07:11:15.948644Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-13T07:11:15.947605Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-01-13T07:11:15.936337Z&quot;}">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> T5Dataset:</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, context, question, target):</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.context <span class="op">=</span> context</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.question <span class="op">=</span> question</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.target <span class="op">=</span> target</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tokenizer <span class="op">=</span> tokenizer</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.input_max_len <span class="op">=</span> INPUT_MAX_LEN</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.out_max_len <span class="op">=</span> OUT_MAX_LEN</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__len__</span>(<span class="va">self</span>):</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.context)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, item):</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        context <span class="op">=</span> <span class="bu">str</span>(<span class="va">self</span>.context[item])</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        context <span class="op">=</span> <span class="st">&quot; &quot;</span>.join(context.split())</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        question <span class="op">=</span> <span class="bu">str</span>(<span class="va">self</span>.question[item])</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        question <span class="op">=</span> <span class="st">&quot; &quot;</span>.join(question.split())</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        target <span class="op">=</span> <span class="bu">str</span>(<span class="va">self</span>.target[item])</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        target <span class="op">=</span> <span class="st">&quot; &quot;</span>.join(target.split())</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        inputs_encoding <span class="op">=</span> <span class="va">self</span>.tokenizer(</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>            context,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>            question,</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>            add_special_tokens<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>            max_length<span class="op">=</span><span class="va">self</span>.input_max_len,</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>            padding <span class="op">=</span> <span class="st">&#39;max_length&#39;</span>,</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>            truncation<span class="op">=</span><span class="st">&#39;only_first&#39;</span>,</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>            return_attention_mask<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>            return_tensors<span class="op">=</span><span class="st">&quot;pt&quot;</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>        output_encoding <span class="op">=</span> <span class="va">self</span>.tokenizer(</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>            target,</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>            <span class="va">None</span>,</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>            add_special_tokens<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>            max_length<span class="op">=</span><span class="va">self</span>.out_max_len,</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>            padding <span class="op">=</span> <span class="st">&#39;max_length&#39;</span>,</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>            truncation<span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>            return_attention_mask<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>            return_tensors<span class="op">=</span><span class="st">&quot;pt&quot;</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>        inputs_ids <span class="op">=</span> inputs_encoding[<span class="st">&quot;input_ids&quot;</span>].flatten()</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>        attention_mask <span class="op">=</span> inputs_encoding[<span class="st">&quot;attention_mask&quot;</span>].flatten()</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> output_encoding[<span class="st">&quot;input_ids&quot;</span>]</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>        labels[labels <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">100</span>  <span class="co"># As per T5 Documentation</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> labels.flatten()</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span> {</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;context&quot;</span>: context,</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;question&quot;</span>: question,</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;answer&quot;</span>: target,</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;inputs_ids&quot;</span>: inputs_ids,</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;attention_mask&quot;</span>: attention_mask,</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;targets&quot;</span>: labels</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> out    </span></code></pre></div>
</div>
<section id="dataloader" class="cell markdown">
<h1>DataLoader</h1>
</section>
<div class="cell code" data-execution_count="10"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-13T07:11:15.952864Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-13T07:11:15.952390Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-13T07:11:15.962462Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-13T07:11:15.961690Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-01-13T07:11:15.952838Z&quot;}">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> T5DatasetModule(pl.LightningDataModule):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, df_train, df_valid):</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.df_train <span class="op">=</span> df_train</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.df_valid <span class="op">=</span> df_valid</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tokenizer <span class="op">=</span> tokenizer</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.input_max_len <span class="op">=</span> INPUT_MAX_LEN</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.out_max_len <span class="op">=</span> OUT_MAX_LEN</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> setup(<span class="va">self</span>, stage<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.train_dataset <span class="op">=</span> T5Dataset(</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        context<span class="op">=</span><span class="va">self</span>.df_train.context.values,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        question<span class="op">=</span><span class="va">self</span>.df_train.question.values,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        target<span class="op">=</span><span class="va">self</span>.df_train.text.values</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.valid_dataset <span class="op">=</span> T5Dataset(</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>        context<span class="op">=</span><span class="va">self</span>.df_valid.context.values,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        question<span class="op">=</span><span class="va">self</span>.df_valid.question.values,</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>        target<span class="op">=</span><span class="va">self</span>.df_valid.text.values</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> train_dataloader(<span class="va">self</span>):</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> torch.utils.data.DataLoader(</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>         <span class="va">self</span>.train_dataset,</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>         batch_size<span class="op">=</span> TRAIN_BATCH_SIZE,</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>         shuffle<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>         num_workers<span class="op">=</span><span class="dv">4</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> val_dataloader(<span class="va">self</span>):</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> torch.utils.data.DataLoader(</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>         <span class="va">self</span>.valid_dataset,</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>         batch_size<span class="op">=</span> VALID_BATCH_SIZE,</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>         num_workers<span class="op">=</span><span class="dv">1</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
</div>
<section id="model-building" class="cell markdown">
<h1>Model Building</h1>
</section>
<div class="cell code" data-execution_count="12"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-13T07:11:15.964587Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-13T07:11:15.963712Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-13T07:11:15.974798Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-13T07:11:15.974048Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-01-13T07:11:15.964550Z&quot;}">
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> T5Model(pl.LightningModule):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model <span class="op">=</span> T5ForConditionalGeneration.from_pretrained(MODEL_NAME, return_dict<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, input_ids, attention_mask, labels<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> <span class="va">self</span>.model(</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>            input_ids<span class="op">=</span>input_ids, </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>            attention_mask<span class="op">=</span>attention_mask, </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>            labels<span class="op">=</span>labels</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> output.loss, output.logits</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> training_step(<span class="va">self</span>, batch, batch_idx):</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        input_ids <span class="op">=</span> batch[<span class="st">&quot;inputs_ids&quot;</span>]</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>        attention_mask <span class="op">=</span> batch[<span class="st">&quot;attention_mask&quot;</span>]</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span> batch[<span class="st">&quot;targets&quot;</span>]</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>        loss, outputs <span class="op">=</span> <span class="va">self</span>(input_ids, attention_mask, labels)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.log(<span class="st">&quot;train_loss&quot;</span>, loss, prog_bar<span class="op">=</span><span class="va">True</span>, logger<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> loss</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> validation_step(<span class="va">self</span>, batch, batch_idx):</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>        input_ids <span class="op">=</span> batch[<span class="st">&quot;inputs_ids&quot;</span>]</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>        attention_mask <span class="op">=</span> batch[<span class="st">&quot;attention_mask&quot;</span>]</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span> batch[<span class="st">&quot;targets&quot;</span>]</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>        loss, outputs <span class="op">=</span> <span class="va">self</span>(input_ids, attention_mask, labels)</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.log(<span class="st">&quot;val_loss&quot;</span>, loss, prog_bar<span class="op">=</span><span class="va">True</span>, logger<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> loss</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> configure_optimizers(<span class="va">self</span>):</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> AdamW(<span class="va">self</span>.parameters(), lr<span class="op">=</span><span class="fl">0.0001</span>)</span></code></pre></div>
</div>
<section id="model-training" class="cell markdown">
<h1>Model Training</h1>
</section>
<div class="cell code" data-execution_count="12"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-13T07:11:15.977118Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-13T07:11:15.976017Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-13T09:04:27.681351Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-13T09:04:27.680155Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-01-13T07:11:15.977062Z&quot;}">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run():</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    df_train, df_valid <span class="op">=</span> train_test_split(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        df[<span class="dv">0</span>:<span class="dv">10000</span>], test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">101</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    df_train <span class="op">=</span> df_train.fillna(<span class="st">&quot;none&quot;</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    df_valid <span class="op">=</span> df_valid.fillna(<span class="st">&quot;none&quot;</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    df_train[<span class="st">&#39;context&#39;</span>] <span class="op">=</span> df_train[<span class="st">&#39;context&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">&quot; &quot;</span>.join(x.split()))</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    df_valid[<span class="st">&#39;context&#39;</span>] <span class="op">=</span> df_valid[<span class="st">&#39;context&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">&quot; &quot;</span>.join(x.split()))</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    df_train[<span class="st">&#39;text&#39;</span>] <span class="op">=</span> df_train[<span class="st">&#39;text&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">&quot; &quot;</span>.join(x.split()))</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    df_valid[<span class="st">&#39;text&#39;</span>] <span class="op">=</span> df_valid[<span class="st">&#39;text&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">&quot; &quot;</span>.join(x.split()))</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    df_train[<span class="st">&#39;question&#39;</span>] <span class="op">=</span> df_train[<span class="st">&#39;question&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">&quot; &quot;</span>.join(x.split()))</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    df_valid[<span class="st">&#39;question&#39;</span>] <span class="op">=</span> df_valid[<span class="st">&#39;question&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">&quot; &quot;</span>.join(x.split()))</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    df_train <span class="op">=</span> df_train.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    df_valid <span class="op">=</span> df_valid.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    dataModule <span class="op">=</span> T5DatasetModule(df_train, df_valid)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    dataModule.setup()</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    device <span class="op">=</span> DEVICE</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    models <span class="op">=</span> T5Model()</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    models.to(device)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    checkpoint_callback  <span class="op">=</span> ModelCheckpoint(</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>        dirpath<span class="op">=</span><span class="st">&quot;/kaggle/working&quot;</span>,</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>        filename<span class="op">=</span><span class="st">&quot;best_checkpoint&quot;</span>,</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>        save_top_k<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>        verbose<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>        monitor<span class="op">=</span><span class="st">&quot;val_loss&quot;</span>,</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">&quot;min&quot;</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    trainer <span class="op">=</span> pl.Trainer(</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>        callbacks <span class="op">=</span> checkpoint_callback,</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>        max_epochs<span class="op">=</span> EPOCHS,</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>        gpus<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>        accelerator<span class="op">=</span><span class="st">&quot;gpu&quot;</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>    trainer.fit(models, dataModule)</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>run()</span></code></pre></div>
<div class="output display_data">
<div class="sourceCode" id="cb17"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;b437d7edf2c041e6b849bb422897c09c&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb18"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb19"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;851c33aa6c4c4212846001f24b2dbcf8&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb20"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb21"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb22"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb23"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb24"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<section id="model-prediction" class="cell markdown">
<h1>Model Prediction</h1>
<hr>
</section>
<div class="cell code" data-execution_count="13"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-13T09:04:27.683793Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-13T09:04:27.683364Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-13T09:04:37.161458Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-13T09:04:37.160459Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-01-13T09:04:27.683730Z&quot;}">
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>train_model <span class="op">=</span> T5Model.load_from_checkpoint(<span class="st">&quot;/kaggle/working/best_checkpoint-v1.ckpt&quot;</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>train_model.freeze()</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_question(context, question):</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    inputs_encoding <span class="op">=</span>  tokenizer(</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        context,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        question,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        add_special_tokens<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        max_length<span class="op">=</span> INPUT_MAX_LEN,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        padding <span class="op">=</span> <span class="st">&#39;max_length&#39;</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        truncation<span class="op">=</span><span class="st">&#39;only_first&#39;</span>,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        return_attention_mask<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        return_tensors<span class="op">=</span><span class="st">&quot;pt&quot;</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    generate_ids <span class="op">=</span> train_model.model.generate(</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        input_ids <span class="op">=</span> inputs_encoding[<span class="st">&quot;input_ids&quot;</span>],</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        attention_mask <span class="op">=</span> inputs_encoding[<span class="st">&quot;attention_mask&quot;</span>],</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        max_length <span class="op">=</span> INPUT_MAX_LEN,</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>        num_beams <span class="op">=</span> <span class="dv">4</span>,</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>        num_return_sequences <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>        no_repeat_ngram_size<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>        early_stopping<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    preds <span class="op">=</span> [</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>        tokenizer.decode(gen_id,</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>        skip_special_tokens<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>        clean_up_tokenization_spaces<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> gen_id <span class="kw">in</span> generate_ids</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&quot;&quot;</span>.join(preds)</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<section id="prediction" class="cell markdown">
<h2>Prediction</h2>
</section>
<div class="cell code" data-execution_count="14"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-13T09:04:37.163505Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-13T09:04:37.163078Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-13T09:04:39.658565Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-13T09:04:39.657409Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-01-13T09:04:37.163465Z&quot;}">
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>context <span class="op">=</span> <span class="st">&quot;Clustering groups of similar cases, for example, </span><span class="ch">\</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="st">can find similar patients, or can be used for customer segmentation in the </span><span class="ch">\</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="st">banking field. Association technique is used for finding items or events that </span><span class="ch">\</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="st">often co-occur, for example, grocery items that are usually bought together</span><span class="ch">\</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="st">by a particular customer. Anomaly detection is used to discover abnormal </span><span class="ch">\</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="st">and unusual cases, for example, it is used for credit card fraud detection.&quot;</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>que <span class="op">=</span> <span class="st">&quot;what is the example of Anomaly detection?&quot;</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(generate_question(context, que))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>credit card fraud detection
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="16"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-13T09:06:58.925465Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-13T09:06:58.925033Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-13T09:07:01.788435Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-13T09:07:01.787450Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-01-13T09:06:58.925428Z&quot;}">
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>context <span class="op">=</span> <span class="st">&quot;Classification is used when your target is categorical, while regression is used when your target variable</span><span class="ch">\</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="st">is continuous. Both classification and regression belong to the category of supervised machine learning algorithms.&quot;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>que <span class="op">=</span> <span class="st">&quot;When is classification used?&quot;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(generate_question(context, que))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>when your target is categorical
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>#Results</p>
<p>Our model is successfully able to answer to the given questions based
on the feeded context</p>
</div>
<div class="cell markdown">
<p>#Resources</p>
<p><a
href="Data:https://www.kaggle.com/datasets/rtatman/questionanswer-dataset"
class="uri">Data:https://www.kaggle.com/datasets/rtatman/questionanswer-dataset</a></p>
<p>t5 resource : <a
href="https://huggingface.co/transformers/v3.0.2/model_doc/t5.html"
class="uri">https://huggingface.co/transformers/v3.0.2/model_doc/t5.html</a></p>
<p>Code and topic reference from this youtube video: <a
href="https://www.youtube.com/watch?v=r6XY80Z9eSA"
class="uri">https://www.youtube.com/watch?v=r6XY80Z9eSA</a></p>
</div>
</body>
</html>
